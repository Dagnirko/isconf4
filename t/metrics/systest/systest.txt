n4h1> cd /tmp/isconftest
n4h2> cd /tmp/isconftest
n4h3> cd /tmp/isconftest
n4h4> cd /tmp/isconftest
n4h1> hostname 
n4h2> hostname 
n4h3> hostname 
n4h4> hostname 
a.hostname n4h1
b.hostname n4h2
c.hostname n4h3
d.hostname n4h4
n4h1> isconf stop
n4h1> /tmp/isconftest/t/isconf stop
n4h1> killall isconf
n4h1> rm -rf /tmp/var
n4h1> rm -rf /tmp/labtest
n4h1> mkdir -p /tmp/var/is/conf
n4h1> echo example.com > /tmp/var/is/conf/domain
n4h2> isconf stop
n4h2> /tmp/isconftest/t/isconf stop
n4h2> killall isconf
n4h2> rm -rf /tmp/var
n4h2> rm -rf /tmp/labtest
n4h2> mkdir -p /tmp/var/is/conf
n4h2> echo example.com > /tmp/var/is/conf/domain
n4h3> isconf stop
n4h3> /tmp/isconftest/t/isconf stop
n4h3> killall isconf
n4h3> rm -rf /tmp/var
n4h3> rm -rf /tmp/labtest
n4h3> mkdir -p /tmp/var/is/conf
n4h3> echo example.com > /tmp/var/is/conf/domain
n4h4> isconf stop
n4h4> /tmp/isconftest/t/isconf stop
n4h4> killall isconf
n4h4> rm -rf /tmp/var
n4h4> rm -rf /tmp/labtest
n4h4> mkdir -p /tmp/var/is/conf
n4h4> echo example.com > /tmp/var/is/conf/domain
n4h1> /tmp/isconftest/t/isconf start
n4h1> /tmp/isconftest/t/isconf up
n4h2> /tmp/isconftest/t/isconf start
n4h2> /tmp/isconftest/t/isconf up
n4h3> /tmp/isconftest/t/isconf start
n4h3> /tmp/isconftest/t/isconf up
n4h4> /tmp/isconftest/t/isconf start
n4h4> /tmp/isconftest/t/isconf up
n4h1> mkdir -p /tmp/labtest
# scp /tmp/tmpwrVwsB root@n4h1:/tmp/labtest/1
n4h1> cat /tmp/labtest/1
n4h1> /tmp/isconftest/t/isconf snap /tmp/labtest/1
n4h1> /tmp/isconftest/t/isconf snap foo
n4h1> /tmp/isconftest/t/isconf -m 'test' lock
n4h1> /tmp/isconftest/t/isconf exec mkdir -p /tmp/labtest
n4h1> /tmp/isconftest/t/isconf snap /tmp/labtest/1
# scp /tmp/tmphhXSZ1 root@n4h1:/tmp/labtest/2
# ssh root@n4h1 chmod +x /tmp/labtest/2
n4h1> /tmp/isconftest/t/isconf snap /tmp/labtest/2
n4h1> /tmp/isconftest/t/isconf exec /tmp/labtest/2 'hey there world!'
n4h1> cat /tmp/labtest/2.out
n4h2> /tmp/isconftest/t/isconf up
n4h2> test -f /tmp/labtest/1
n4h2> test -f /tmp/labtest/2.out
n4h1> /tmp/isconftest/t/isconf ci
n4h2> /tmp/isconftest/t/isconf up
n4h2> cat /tmp/labtest/1
n4h2> cat /tmp/labtest/2.out
n4h2> grep message: /tmp/var/is/fs/cache/example.com/volume/generic/journal | grep test | wc -l
n4h3> /tmp/isconftest/t/isconf lock update check
n4h3> /tmp/isconftest/t/isconf up
n4h3> /tmp/isconftest/t/isconf lock update check again
n4h3> /tmp/isconftest/t/isconf unlock
n4h1> export IS_NOBROADCAST=1
n4h2> export IS_NOBROADCAST=1
n4h1> export IS_NETS=/tmp/isconftest/t/nets.limbo
n4h2> export IS_NETS=/tmp/isconftest/t/nets.limbo
n4h1> /tmp/isconftest/t/isconf restart
n4h2> /tmp/isconftest/t/isconf restart
n4h1> /tmp/isconftest/t/isconf lock test IS_NOBROADCAST a
n4h2> /tmp/isconftest/t/isconf lock test IS_NOBROADCAST b
n4h2> /tmp/isconftest/t/isconf unlock
# scp /tmp/tmpDiGqXE root@n4h1:/tmp/labtest/nobroadcast
n4h1> /tmp/isconftest/t/isconf snap /tmp/labtest/nobroadcast
n4h1> /tmp/isconftest/t/isconf ci
n4h2> /tmp/isconftest/t/isconf up
n4h2> cat /tmp/labtest/nobroadcast
n4h1> export IS_NETS=/tmp/isconftest/t/nets
n4h2> export IS_NETS=/tmp/isconftest/t/nets
n4h1> /tmp/isconftest/t/isconf restart
n4h2> /tmp/isconftest/t/isconf restart
n4h2> /tmp/isconftest/t/isconf lock test IS_NOBROADCAST b
n4h2> /tmp/isconftest/t/isconf up
n4h2> cat /tmp/labtest/nobroadcast
n4h3> /tmp/isconftest/t/isconf up
n4h3> cat /tmp/labtest/nobroadcast
n4h2> /tmp/isconftest/t/isconf stop
n4h2> rm -rf /tmp/var
n4h2> rm -rf /tmp/labtest
n4h2> /tmp/isconftest/t/isconf start
n4h2> /tmp/isconftest/t/isconf up
n4h2> cat /tmp/labtest/2.out
n4h1> /tmp/isconftest/t/isconf -m 'test multiple ci' lock
# scp /tmp/tmp-de_Qj root@n4h1:/tmp/labtest/multiple
n4h1> /tmp/isconftest/t/isconf snap /tmp/labtest/multiple
n4h1> /tmp/isconftest/t/isconf ci
n4h2> /tmp/isconftest/t/isconf up
n4h2> cat /tmp/labtest/multiple
n4h3> /tmp/isconftest/t/isconf up
n4h3> /tmp/isconftest/t/isconf fork branch2
n4h3> /tmp/isconftest/t/isconf up
n4h3> /tmp/isconftest/t/isconf -m 'test fork' lock
# scp /tmp/tmpgv9yG8 root@n4h3:/tmp/labtest/fork
n4h3> /tmp/isconftest/t/isconf snap /tmp/labtest/fork
n4h3> /tmp/isconftest/t/isconf ci
n4h4> /tmp/isconftest/t/isconf migrate branch2
n4h4> /tmp/isconftest/t/isconf up
n4h4> cat /tmp/labtest/multiple
n4h4> cat /tmp/labtest/fork
n4h1> /tmp/isconftest/t/isconf up
n4h1> test -f /tmp/labtest/fork
n4h2> /tmp/isconftest/t/isconf up
n4h2> test -f /tmp/labtest/fork
# ssh root@n4h1 /tmp/isconftest/t/isconf restart
> /tmp/isconftest/t/isconf ci
n4h4> /tmp/isconftest/t/isconf migrate branch2
n4h4> /tmp/isconftest/t/isconf up
n4h4> cat /tmp/labtest/multiple
n4h4> cat /tmp/labtest/fork
n4h1> /tmp/isconftest/t/isconf up
n4h1> test -f /tmp/labtest/fork
n4h2> /tmp/isconftest/t/isconf up
n4h2> test -f /tmp/labtest/fork
# ssh root@n4h2 /tmp/isconftest/t/isconf restart
> /tmp/isconftest/t/isconf ci
n4h4> /tmp/isconftest/t/isconf migrate branch2
n4h4> /tmp/isconftest/t/isconf up
n4h4> cat /tmp/labtest/multiple
n4h4> cat /tmp/labtest/fork
n4h1> /tmp/isconftest/t/isconf up
n4h1> test -f /tmp/labtest/fork
n4h2> /tmp/isconftest/t/isconf up
n4h2> test -f /tmp/labtest/fork
n4h1> /tmp/isconftest/t/isconf up
n4h2> /tmp/isconftest/t/isconf up
n4h1> mkdir /tmp/labtest/dira
n4h1> mkdir /tmp/labtest/dira/dirb
# scp /tmp/tmpHkxBiU root@n4h1:/tmp/labtest/dira/dirb/foo
n4h1> /tmp/isconftest/t/isconf -m 'test missing parent dirs' lock
n4h1> /tmp/isconftest/t/isconf snap /tmp/labtest/dira/dirb/foo
n4h1> /tmp/isconftest/t/isconf ci
n4h2> /tmp/isconftest/t/isconf up
n4h2> cat /tmp/labtest/dira/dirb/foo

123 tests: 0 failed, 123 passed (100%)
